<div class="min-h-screen bg-gray-50">
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-gray-900">Calendar Map</h1>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-700">Welcome, <%= current_user[:name] %></span>
                    <a href="/logout" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-md transition-colors">
                        Sign out
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-900">
                    Events for <span id="selected-date-display"></span>
                </h2>
                <div class="flex items-center space-x-2">
                    <button id="prev-day" class="px-3 py-2 rounded-md border border-gray-300 hover:bg-gray-50 transition-colors font-medium" title="Previous Day">
                        ←
                    </button>
                    <input type="date" id="date-picker" class="px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <button id="next-day" class="px-3 py-2 rounded-md border border-gray-300 hover:bg-gray-50 transition-colors font-medium" title="Next Day">
                        →
                    </button>
                    <button id="today-btn" class="px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors">
                        Today
                    </button>
                </div>
            </div>
            <p class="text-gray-600">
                Your calendar events with locations are displayed below.
            </p>
        </div>

        <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Today's Events</h3>
            <div id="events-list" class="hidden space-y-3">
                <!-- Events will be populated by JavaScript -->
            </div>
        </div>
        
        <div id="loading" class="flex items-center justify-center">
            <div class="text-lg">Loading events...</div>
        </div>
        
        <div id="error" class="hidden">
            <div class="text-red-600">Error loading events</div>
        </div>
        
        <div id="no-events" class="hidden">
            <div class="text-gray-600">No events with locations found for today</div>
        </div>
        
        <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Map</h3>
            <div id="map-container" class="hidden h-96 w-full rounded-lg overflow-hidden border">
                <div id="map" class="h-full w-full"></div>
            </div>
        </div>
    </main>
</div>

<script>
window.addEventListener('DOMContentLoaded', function() {
    // Setup date controls and initialize
    setupDateControls();
    initializeMap();
    
    // Handle browser back/forward navigation
    window.addEventListener('popstate', function(event) {
        if (event.state && event.state.date) {
            const parts = event.state.date.split('-');
            const year = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1;
            const day = parseInt(parts[2], 10);
            currentDate = new Date(year, month, day);
            updateDateDisplay(currentDate);
            loadEventsForDate(currentDate);
        }
    });
});
</script>